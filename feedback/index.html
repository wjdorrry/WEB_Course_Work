<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="https://cdn.discordapp.com/attachments/1246484201247871047/1375933145026662430/image.png?ex=68337d19&is=68322b99&hm=935fc672f26b582a2e8fdc11f7e4b66b19eca235962d60c9fa9b0bb638655520&" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Отзывы</title>
</head>
<body>
<div id="preloader">
    <div class="loader"></div>
</div>

<header class="header">
    <widget-header></widget-header>
</header>
<main class="main">
    <h1>Оставить отзыв</h1>

    <label for="productSelect"></label><select id="productSelect"></select>

    <label for="reviewText"></label><textarea id="reviewText" placeholder="Ваш отзыв..."></textarea>
    <p id="reviewError" class="input-error"></p>

    <button id="submitReviewBtn" class="review-btn">Отправить отзыв</button>

    <h2>Отзывы</h2>
    <div id="feedbackList" class="feedback-container"></div>
</main>

<footer class="footer">
    <widget-footer></widget-footer>
</footer>
<div style="position: fixed; bottom: 0; left: 0;">
    <div class="text-scale-controls">
        <button data-scale="0.8">A-</button>
        <button data-scale="1" class="active">A</button>
        <button data-scale="1.2">A+</button>
    </div>
    <div class="theme-switcher">
        <button data-theme="default" class="active">Стандарт</button>
        <button data-theme="dark">Тёмная</button>
        <button data-theme="beige">Бежевая</button>
        <button data-theme="blue">Синяя</button>
    </div>
    <button class="toggle-images-btn">Скрыть картинки</button>

</div>
<script type="module" src="feedback-index.js"></script>
<script>
    function setTextScale(scale) {
        document.documentElement.style.setProperty('--text-scale', scale);
        localStorage.setItem('textScale', scale);

        const header = document.querySelector('.header');
        if (header) {
            header.style.fontSize = `${scale}em`;
        }

        document.querySelectorAll('.catalog-item, .catalog-item *').forEach(el => {
            el.style.fontSize = `${scale}em`;
        });
    }

    document.querySelectorAll('[data-scale]').forEach(btn => {
        btn.addEventListener('click', function() {
            const scale = parseFloat(this.dataset.scale);
            setTextScale(scale);

            document.querySelectorAll('[data-scale]').forEach(b =>
                b.classList.remove('active'));
            this.classList.add('active');
        });
    });

    document.querySelectorAll('[data-theme]').forEach(btn => {
        btn.addEventListener('click', function() {
            const theme = this.dataset.theme;

            if (theme === "default") {

                document.documentElement.classList.remove(
                    'dark-theme', 'beige-theme', 'blue-theme'
                );

                document.querySelectorAll('[data-theme]').forEach(b =>
                    b.classList.remove('active'));

                localStorage.removeItem('colorTheme');
                this.classList.add('active');
                return;
            }

            // Вешаем выбранную тему
            document.documentElement.classList.remove(
                'dark-theme', 'beige-theme', 'blue-theme'
            );
            document.documentElement.classList.add(`${theme}-theme`);

            document.querySelectorAll('[data-theme]').forEach(b =>
                b.classList.remove('active'));
            this.classList.add('active');

            localStorage.setItem('colorTheme', theme);
        });
    });

    document.querySelectorAll('[data-theme]').forEach(btn => {
        btn.addEventListener('click', function() {
            const theme = this.dataset.theme;
            setTheme(theme);

            document.querySelectorAll('[data-theme]').forEach(b =>
                b.classList.remove('active'));
            this.classList.add('active');
        });
    });

    document.querySelector('.toggle-images-btn').addEventListener('click', function() {
        const imagesDisabled = !this.classList.toggle('active');

        if (imagesDisabled) {
            document.body.classList.add('no-images');
        } else {
            document.body.classList.remove('no-images');
        }

        document.querySelectorAll('img, svg, .icon').forEach(el => {
            if (imagesDisabled) {
                el.dataset.originalDisplay = el.style.display || '';
                el.style.display = 'none';

                if (el.alt) {
                    const desc = document.createElement('div');
                    desc.className = 'image-alt-text';
                    desc.textContent = el.alt;
                    el.parentNode.insertBefore(desc, el.nextSibling);
                }
            } else {
                el.style.display = el.dataset.originalDisplay || '';
                document.querySelectorAll('.image-alt-text').forEach(d => d.remove());
            }
        });

        localStorage.setItem('imagesDisabled', imagesDisabled);
    });

    document.addEventListener('DOMContentLoaded', () => {
        const savedScale = localStorage.getItem('textScale') || '1';
        setTextScale(savedScale);
        document.querySelector(`[data-scale="${savedScale}"]`)?.classList.add('active');

        const savedTheme = localStorage.getItem('colorTheme');
        if (savedTheme) {
            const themeBtn = document.querySelector(`[data-theme="${savedTheme}"]`);
            if (themeBtn) themeBtn.click();
        }

        if (localStorage.getItem('imagesDisabled') === 'true') {
            document.querySelector('.toggle-images-btn').classList.add('active');
            document.body.classList.add('no-images');
        }
    });
</script>
</body>
</html>
